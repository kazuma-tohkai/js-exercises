# マルチスレッド

参考URL:[【NTT西日本】マルチスレッド｜ICT用語集｜法人・ 企業向け ICT サービス ・ ソリューション](https://www.ntt-west.co.jp/business/glossary/words-00262.html)

マルチスレッドとは、一つのコンピュータープログラムを実行する際に、アプリケーションのプロセス（タスク）を複数のスレッドに分けて並行処理する流れのことです。マルチスレッドの対義語はシングルスレッドで、ソースコードの上から順に一つの処理を行ないます。
スレッドとはCPUから見たプログラムの実行単位であり、プロセスの中に組み込まれているものです。マルチスレッドとは、複数のスレッドが一つのプロセス内で実行されることを表します。

マルチスレッドを用いると、プロセス内で複数の処理を同時に行なうため、処理速度と精度が飛躍的に向上します。メインルーチンの処理に加え、サブルーチンの処理や複数のプロシージャも同時に処理できます。ただし、マルチスレッドはスレッドを高速で切り替えながら処理するため、切り替えのタイミングによってはバグを起こす可能性もあります。

CPUコアが複数あるコンピューターはマルチスレッド処理が可能です。ただし、単一のCPUであっても、利用時間を分割し、順番を割り当てることでマルチスレッドが可能になります。スレッドの管理をプログラム内のコードで行なうものをユーザースレッド、OSカーネルが行なうものをカーネルスレッドと呼びます

# mFib.jsの実行時間計測

- 項数43, 45, 47の3パターン、スレッド数1,2,3,4,8の4パターンの組み合わせで実行時間を計測した。
- どの項数でもスレッド数4まではスレッド数を増やした方が実行時間は短くなった。
- スレッド数4と8はほぼ同じ実行時間であった。
- スレッド数4の実行時間はスレッド数1の実行時間の49~51%となっている。

| 項数(第一引数) | スレッド数(第二引数) | Total execution time(s) |
| -------------- | -------------------- | ----------------------- |
| 43             | 1                    | 6.510                   |
| 43             | 2                    | 4.342                   |
| 43             | 3                    | 3.971                   |
| 43             | 4                    | 3.365                   |
| 43             | 8                    | 3.165                   |
| 45             | 1                    | 17.151                  |
| 45             | 2                    | 12.775                  |
| 45             | 3                    | 10.028                  |
| 45             | 4                    | 8.624                   |
| 45             | 8                    | 8.047                   |
| 47             | 1                    | 45.278                  |
| 47             | 2                    | 33.220                  |
| 47             | 3                    | 25.475                  |
| 47             | 4                    | 22.511                  |
| 47             | 8                    | 22.698                  |

# 適切なスレッド数

- 自分のPCのCPUスペック
  - コア数：4
  - 論理プロセッサ数:8
- 適切なスレッド数
  - 基本的にはコア数(=4)が適切なスレッド数
  - ただし、論理プロセッサ数がコア数の2倍になっているときはハイパースレッディングがONになっているので、その数(=8)が適切なスレッド数となる
